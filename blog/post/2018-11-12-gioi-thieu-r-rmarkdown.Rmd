---
title: "Giới thiệu về R Markdown"
author: "Cuong Sai"
date: 2018-11-12
categories: ["rmarkdown"]
---

Nghiên cứu khoa học khả lặp - reproducible research đang là xu thế mới của giới khoa học và những package sẽ giúp người nghiên cứu khoa học hoàn toàn có thể viết báo cáo của mình bằng các mã nguồn R, tận dụng các thể mạnh tính toán data visualization của R, viết biểu thức toán với Latex và có thể tự động hoá quá trình.

Đây là văn bản [R Markdown](http://rmarkdown.rstudio.com). Khi bạn cần làm báo cáo với code mã nguồn
kèm theo thì Rmarkdown và knirt sẽ là giải pháp vô cùng tuyệt vời trong R.

### 1. Rmarkdown làm việc như thế nào? 

Đây là một file R Markdown với định dạng là .Rmd:

![](/img/rmarkdown/1.png)


File này gồm 3 thành phần chính:

- Tiêu đề: ---s
- R code chunks: ```s
- Văn bản text bình thường

Để xuất báo cáo ra từ .Rmd file này ta dùng lệnh **render**:

```{r, eval = FALSE}
library(rmarkdown)
render("tên-của-file.Rmd")
```

R markdown sẽ xuất ra file mới có chứa text, code, và kết quả từ .Rmd file. File mới này có thể là
[web page](https://rmarkdown.rstudio.com/html_document_format.html),  [PDF](https://rmarkdown.rstudio.com/pdf_document_format.html),[MS Word](https://rmarkdown.rstudio.com/word_document_format.html) văn bản, [slide show](https://rmarkdown.rstudio.com/ioslides_presentation_format.html), [notebook](https://rmarkdown.rstudio.com/r_notebooks.html), [handout](https://rmarkdown.rstudio.com/tufte_handout_format.html), [book](https://bookdown.org/),
[dashboard](https://rmarkdown.rstudio.com/flexdashboard/index.html), [package Vinette(html)](https://rmarkdown.rstudio.com/package_vignette_format.html), hay là [các định dạng khác](https://rmarkdown.rstudio.com/formats.html).

Quá trình làm việc sẽ diễn ra như sau:

![](/img/rmarkdown/2.png)

Khi bạn chạy lệnh **render** R Markdown sẽ cấp cho **knirt** file .Rmd. **knirt** sẽ thi hành tất cả các code chunks trong văn bản và tạo ra một file mới với định dạng .md bao gồm code mã nguồn và kết qur thực hiện code chunks.

File mardown này đươc được khởi tạo bằng **knirt** và sau đó được xử lý bằng **pandoc** để tạo ra file cuối cùng.

Quá trình này nghe có vẻ phức tạp nhưng R Markdown thực hiện nó vô cùng đơn giản bằng các đóng gói tất xả các quy trình trên bằng một hàm **render**.


### 2. Code chunks

ví dụ 1 R Markdown file dưới đây bao gồm 3 code chunks:

![](/img/rmarkdown/3.png)


Để thêm một chunk mới bạn có thể click vào *insert chunk* hoặc dùng tổ hợp phím *Ctrl+Alt+*I hoặc tạo thủ công:

```{r}
# ```{r} và ```
```

Để thi hành code chunk này thì bạn click *run* hoặc nhấn tổ hợp phím *Ctrl+Shift+Enter*.

Khi bạn lưu file notebook hay HTML có chứa code thì kết quả được lưu lại kèm theo nó là nút *Preview* hoặc tổ phím *Ctrl+Shift+K* giúp cho chúng ta có thể xem trước kết qủa của văn bản.

#### Code chunks có những tùy chọn cục bộ sau:

- include = FALSE prevents code and results from appearing in the finished file. R Markdown still runs the code in the chunk, and the results can be used by other chunks.
- echo = FALSE prevents code, but not the results from appearing in the finished file. This is a useful way to embed figures.
- message = FALSE prevents messages that are generated by code from appearing in the finished file.
- warning = FALSE prevents warnings that are generated by code from appearing in the finished.
- fig.cap = "..." adds a caption to graphical results.

Có thể xem thêm các tùy chọn cho code chunks ở  [Markdown Reference Guide](https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf)

Ví dụ với tùy chọn **include**:

![](/img/rmarkdown/4.png)



#### Tùy chọn toàn cục cho Code chunks:

Để áp dụng tùy chọn cho tất cả các code chunks có trong văn bản của bạn hay còn gọi là thiết lập toàn cục, các bạn gọi *knitr::opts_chunk$set*.

Ví dụ:
```{r}
#```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = TRUE)
#```
```

### 3. Line code trong R Markdown

Kết quả thực hiện code có thể chèn trực tiếp vào text của  một file .Rmd bằng cú pháp sau
```{r}
# ` r function`
```

Ví dụ dưới đây gọi *colorFunc*, và trả về kết quả là *heat.colors.*:

![](/img/rmarkdown/5.png)


Điều này thực sự có ích khi chúng ta cần cập nhật báo cáo với một function khác:

![](/img/rmarkdown/6.png)

R Markdown sẽ luôn luôn:

- Hiển thị kết quả của line code, chứ không hiện thị code
- Sử dụng text liên quan để hiện thị kết quả

### 4. Code Languages

**Knirt** có thể thực thi code của rất nhiều ngôn ngữ khác chứ không chỉ riêng R như là:

- Python
- Python
- SQL
- Bash
- Rcpp
- Stan
- JavaScript
- CSS

Ví dụ thực thi code trong **Bash** và **Python**:

![](/img/rmarkdown/7.png)

Để tìm hiểu thêm về cách sử dụng các ngôn ngữ khác với R Markdown [ ở đây](https://rmarkdown.rstudio.com/authoring_knitr_engines.html)

### 5. Sử dụng Parameters trong R Markdown

R Markdown document có thể bao gồm một số tham số (parameters) được thiết lập khi làn báo cáo. Ví dụ dưới đây sử dụng data parameter để xác định data set cho việc tạo biểu đồ:

![](/img/rmarkdown/8.png)

#### Declaring Parameters:

 Parameters được tuyên bố bằng cách sử dụng trường params trong YAML header của văn bản. Ví dụ văn bản ở trên tạo parameter data và gán mặc định cho nó là "hawaii"
 
#### Sử dụng parameters trong Code:
 
 Các parameters đều sẵn sàng trong môi trường knit như là một danh sách chỉ để đọc với tên params. Để sử dụng parameter trong Code, cần gọi theo cú pháp sau:
 
```{r}
# params$<parameter name>
```

#### Thiết lập parameters values:

Thêm params argument vào **render** để tạo báo cáo sử dụng tập hợp parameter values mới. Đưới đâylà sửa đổi báo cáo sự dụng  *aleutians data set*:

```{r}
#render("5-parameters.Rmd", params = list(data = "aleutians"))
```

![](/img/rmarkdown/9.png)

Tốt hơn, nhấn vào tùy chọn “Knit with Parameters” để thiết lập các parameters, render, và xem trước báo cáo trong 1 bước:

![](/img/rmarkdown/10.png)


Parameters thực sự hữu ích khi bạn muốn re-render một báo cáo tương tự với values đầu vào mới, ví dụ như:

- Chạy một báo cáo cụ thể đến một bộ phận hay địa lý khu vực.
- Chạy một bản báo cáo đó bao gồm một khoảng thời gian cụ thể trong thời gian.
- Chạy nhiều phiên bản của một báo cáo riêng biệt vơi bộ lõi giả định.

Để tìm hiểu thêm về paramaterized reports [tại đây](https://rmarkdown.rstudio.com/developer_parameterized_reports.html)


### 6. Các thiết lập cho bảng dữ liệu trong R Markdown

Với mặc định R Markdown hiển thị data frames và matrixes giống nhứ trong R terminal (in a monospaced font). Nếu bạn muốn dữ liệu của mình được hiển thị dưới dạng khác bạn có thể sử dụng hàm **knirt::kable** như  ví dụ bên dưới:


![](/img/rmarkdown/11.png)

Nêu bạn sử dụng chunk tùy chọn **results = 'asis'**. Điều này cần thiết để đảm bảo rằng kết quả table output không chỉ được xử lý đơn thuần bởi knirt.


### 7. Markdown Basics

Đinh dạng văn bản text trong R Markdown file với Pandoc's Markdown:

![](/img/rmarkdown/12.png)
 
 Bạn có thể sử dụng Pandoc’s Markdown để tạo:
 
- Headers
- Lists
- Links
- Images
- Block quotes
- Latex equations
- Horizontal rules
- Tables
- Footnotes
- Bibliographies and Citations
- Slide breaks
- Italicized text
- Bold text
- Superscripts
- Subscripts
- Strikethrough text

Bạn có thể tìm hiểu thêm về Markdown ở [Pandoc's Markdown](https://rmarkdown.rstudio.com/authoring_pandoc_markdown.html) hoặc [R Markdown Cheatsheet](https://www.rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf)

 
## Ví dụ

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

You can embed an R code chunk like this:

```{r cars}
summary(cars)
fit <- lm(dist ~ speed, data = cars)
fit
```

## Including Plots

You can also embed plots. See Figure \@ref(fig:pie) for example:

```{r pie, fig.cap='A fancy pie chart.', tidy=FALSE}
par(mar = c(0, 1, 0, 1))
pie(
  c(280, 60, 20),
  c('Sky', 'Sunny side of pyramid', 'Shady side of pyramid'),
  col = c('#0292D8', '#F7EA39', '#C4B632'),
  init.angle = -50, border = NA
)
```
